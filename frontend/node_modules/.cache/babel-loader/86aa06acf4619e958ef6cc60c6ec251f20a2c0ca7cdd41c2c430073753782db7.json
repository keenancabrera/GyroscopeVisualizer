{"ast":null,"code":"import { transformedNormalView } from '../../accessors/NormalNode.js';\nimport { positionViewDirection } from '../../accessors/PositionNode.js';\nimport { sheen, sheenRoughness } from '../../core/PropertyNode.js';\nimport { tslFn, float } from '../../shadernode/ShaderNode.js';\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst D_Charlie = (roughness, dotNH) => {\n  const alpha = roughness.pow2();\n\n  // Estevez and Kulla 2017, \"Production Friendly Microfacet Sheen BRDF\"\n  const invAlpha = float(1.0).div(alpha);\n  const cos2h = dotNH.pow2();\n  const sin2h = cos2h.oneMinus().max(0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n  return float(2.0).add(invAlpha).mul(sin2h.pow(invAlpha.mul(0.5))).div(2.0 * Math.PI);\n};\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst V_Neubelt = (dotNV, dotNL) => {\n  // Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\n  return float(1.0).div(float(4.0).mul(dotNL.add(dotNV).sub(dotNL.mul(dotNV))));\n};\nconst BRDF_Sheen = tslFn(({\n  lightDirection\n}) => {\n  const halfDir = lightDirection.add(positionViewDirection).normalize();\n  const dotNL = transformedNormalView.dot(lightDirection).clamp();\n  const dotNV = transformedNormalView.dot(positionViewDirection).clamp();\n  const dotNH = transformedNormalView.dot(halfDir).clamp();\n  const D = D_Charlie(sheenRoughness, dotNH);\n  const V = V_Neubelt(dotNV, dotNL);\n  return sheen.mul(D).mul(V);\n});\nexport default BRDF_Sheen;","map":{"version":3,"names":["transformedNormalView","positionViewDirection","sheen","sheenRoughness","tslFn","float","D_Charlie","roughness","dotNH","alpha","pow2","invAlpha","div","cos2h","sin2h","oneMinus","max","add","mul","pow","Math","PI","V_Neubelt","dotNV","dotNL","sub","BRDF_Sheen","lightDirection","halfDir","normalize","dot","clamp","D","V"],"sources":["/Users/cabrera/Documents/GyroscopeVisualizer/frontend/node_modules/three/examples/jsm/nodes/functions/BSDF/BRDF_Sheen.js"],"sourcesContent":["import { transformedNormalView } from '../../accessors/NormalNode.js';\nimport { positionViewDirection } from '../../accessors/PositionNode.js';\nimport { sheen, sheenRoughness } from '../../core/PropertyNode.js';\nimport { tslFn, float } from '../../shadernode/ShaderNode.js';\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst D_Charlie = ( roughness, dotNH ) => {\n\n\tconst alpha = roughness.pow2();\n\n\t// Estevez and Kulla 2017, \"Production Friendly Microfacet Sheen BRDF\"\n\tconst invAlpha = float( 1.0 ).div( alpha );\n\tconst cos2h = dotNH.pow2();\n\tconst sin2h = cos2h.oneMinus().max( 0.0078125 ); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\n\treturn float( 2.0 ).add( invAlpha ).mul( sin2h.pow( invAlpha.mul( 0.5 ) ) ).div( 2.0 * Math.PI );\n\n};\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs\nconst V_Neubelt = ( dotNV, dotNL ) => {\n\n\t// Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline for The Order: 1886\"\n\treturn float( 1.0 ).div( float( 4.0 ).mul( dotNL.add( dotNV ).sub( dotNL.mul( dotNV ) ) ) );\n\n};\n\nconst BRDF_Sheen = tslFn( ( { lightDirection } ) => {\n\n\tconst halfDir = lightDirection.add( positionViewDirection ).normalize();\n\n\tconst dotNL = transformedNormalView.dot( lightDirection ).clamp();\n\tconst dotNV = transformedNormalView.dot( positionViewDirection ).clamp();\n\tconst dotNH = transformedNormalView.dot( halfDir ).clamp();\n\n\tconst D = D_Charlie( sheenRoughness, dotNH );\n\tconst V = V_Neubelt( dotNV, dotNL );\n\n\treturn sheen.mul( D ).mul( V );\n\n} );\n\nexport default BRDF_Sheen;\n"],"mappings":"AAAA,SAASA,qBAAqB,QAAQ,+BAA+B;AACrE,SAASC,qBAAqB,QAAQ,iCAAiC;AACvE,SAASC,KAAK,EAAEC,cAAc,QAAQ,4BAA4B;AAClE,SAASC,KAAK,EAAEC,KAAK,QAAQ,gCAAgC;;AAE7D;AACA,MAAMC,SAAS,GAAGA,CAAEC,SAAS,EAAEC,KAAK,KAAM;EAEzC,MAAMC,KAAK,GAAGF,SAAS,CAACG,IAAI,CAAC,CAAC;;EAE9B;EACA,MAAMC,QAAQ,GAAGN,KAAK,CAAE,GAAI,CAAC,CAACO,GAAG,CAAEH,KAAM,CAAC;EAC1C,MAAMI,KAAK,GAAGL,KAAK,CAACE,IAAI,CAAC,CAAC;EAC1B,MAAMI,KAAK,GAAGD,KAAK,CAACE,QAAQ,CAAC,CAAC,CAACC,GAAG,CAAE,SAAU,CAAC,CAAC,CAAC;;EAEjD,OAAOX,KAAK,CAAE,GAAI,CAAC,CAACY,GAAG,CAAEN,QAAS,CAAC,CAACO,GAAG,CAAEJ,KAAK,CAACK,GAAG,CAAER,QAAQ,CAACO,GAAG,CAAE,GAAI,CAAE,CAAE,CAAC,CAACN,GAAG,CAAE,GAAG,GAAGQ,IAAI,CAACC,EAAG,CAAC;AAEjG,CAAC;;AAED;AACA,MAAMC,SAAS,GAAGA,CAAEC,KAAK,EAAEC,KAAK,KAAM;EAErC;EACA,OAAOnB,KAAK,CAAE,GAAI,CAAC,CAACO,GAAG,CAAEP,KAAK,CAAE,GAAI,CAAC,CAACa,GAAG,CAAEM,KAAK,CAACP,GAAG,CAAEM,KAAM,CAAC,CAACE,GAAG,CAAED,KAAK,CAACN,GAAG,CAAEK,KAAM,CAAE,CAAE,CAAE,CAAC;AAE5F,CAAC;AAED,MAAMG,UAAU,GAAGtB,KAAK,CAAE,CAAE;EAAEuB;AAAe,CAAC,KAAM;EAEnD,MAAMC,OAAO,GAAGD,cAAc,CAACV,GAAG,CAAEhB,qBAAsB,CAAC,CAAC4B,SAAS,CAAC,CAAC;EAEvE,MAAML,KAAK,GAAGxB,qBAAqB,CAAC8B,GAAG,CAAEH,cAAe,CAAC,CAACI,KAAK,CAAC,CAAC;EACjE,MAAMR,KAAK,GAAGvB,qBAAqB,CAAC8B,GAAG,CAAE7B,qBAAsB,CAAC,CAAC8B,KAAK,CAAC,CAAC;EACxE,MAAMvB,KAAK,GAAGR,qBAAqB,CAAC8B,GAAG,CAAEF,OAAQ,CAAC,CAACG,KAAK,CAAC,CAAC;EAE1D,MAAMC,CAAC,GAAG1B,SAAS,CAAEH,cAAc,EAAEK,KAAM,CAAC;EAC5C,MAAMyB,CAAC,GAAGX,SAAS,CAAEC,KAAK,EAAEC,KAAM,CAAC;EAEnC,OAAOtB,KAAK,CAACgB,GAAG,CAAEc,CAAE,CAAC,CAACd,GAAG,CAAEe,CAAE,CAAC;AAE/B,CAAE,CAAC;AAEH,eAAeP,UAAU"},"metadata":{},"sourceType":"module","externalDependencies":[]}