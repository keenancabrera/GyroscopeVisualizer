{"ast":null,"code":"import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable, nodeProxy } from '../shadernode/ShaderNode.js';\nimport { cameraNear, cameraFar } from '../accessors/CameraNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { viewportDepthTexture } from './ViewportDepthTextureNode.js';\nclass ViewportDepthNode extends Node {\n  constructor(scope, textureNode = null) {\n    super('float');\n    this.scope = scope;\n    this.textureNode = textureNode;\n    this.isViewportDepthNode = true;\n  }\n  setup( /*builder*/\n  ) {\n    const {\n      scope\n    } = this;\n    let node = null;\n    if (scope === ViewportDepthNode.DEPTH) {\n      node = viewZToOrthographicDepth(positionView.z, cameraNear, cameraFar);\n    } else if (scope === ViewportDepthNode.DEPTH_TEXTURE) {\n      const texture = this.textureNode || viewportDepthTexture();\n      const viewZ = perspectiveDepthToViewZ(texture, cameraNear, cameraFar);\n      node = viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\n    }\n    return node;\n  }\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\n// -near maps to 0; -far maps to 1\nexport const viewZToOrthographicDepth = (viewZ, near, far) => viewZ.add(near).div(near.sub(far));\n\n// maps orthographic depth in [ 0, 1 ] to viewZ\nexport const orthographicDepthToViewZ = (depth, near, far) => near.sub(far).mul(depth).sub(near);\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\n// -near maps to 0; -far maps to 1\nexport const viewZToPerspectiveDepth = (viewZ, near, far) => near.add(viewZ).mul(far).div(near.sub(far).mul(viewZ));\n\n// maps perspective depth in [ 0, 1 ] to viewZ\nexport const perspectiveDepthToViewZ = (depth, near, far) => near.mul(far).div(far.sub(near).mul(depth).sub(far));\nViewportDepthNode.DEPTH = 'depth';\nViewportDepthNode.DEPTH_TEXTURE = 'depthTexture';\nexport default ViewportDepthNode;\nexport const depth = nodeImmutable(ViewportDepthNode, ViewportDepthNode.DEPTH);\nexport const depthTexture = nodeProxy(ViewportDepthNode, ViewportDepthNode.DEPTH_TEXTURE);\naddNodeClass('ViewportDepthNode', ViewportDepthNode);","map":{"version":3,"names":["Node","addNodeClass","nodeImmutable","nodeProxy","cameraNear","cameraFar","positionView","viewportDepthTexture","ViewportDepthNode","constructor","scope","textureNode","isViewportDepthNode","setup","node","DEPTH","viewZToOrthographicDepth","z","DEPTH_TEXTURE","texture","viewZ","perspectiveDepthToViewZ","near","far","add","div","sub","orthographicDepthToViewZ","depth","mul","viewZToPerspectiveDepth","depthTexture"],"sources":["/Users/cabrera/Documents/GyroscopeVisualizer/frontend/node_modules/three/examples/jsm/nodes/display/ViewportDepthNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable, nodeProxy } from '../shadernode/ShaderNode.js';\nimport { cameraNear, cameraFar } from '../accessors/CameraNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { viewportDepthTexture } from './ViewportDepthTextureNode.js';\n\nclass ViewportDepthNode extends Node {\n\n\tconstructor( scope, textureNode = null ) {\n\n\t\tsuper( 'float' );\n\n\t\tthis.scope = scope;\n\t\tthis.textureNode = textureNode;\n\n\t\tthis.isViewportDepthNode = true;\n\n\t}\n\n\tsetup( /*builder*/ ) {\n\n\t\tconst { scope } = this;\n\n\t\tlet node = null;\n\n\t\tif ( scope === ViewportDepthNode.DEPTH ) {\n\n\t\t\tnode = viewZToOrthographicDepth( positionView.z, cameraNear, cameraFar );\n\n\t\t} else if ( scope === ViewportDepthNode.DEPTH_TEXTURE ) {\n\n\t\t\tconst texture = this.textureNode || viewportDepthTexture();\n\n\t\t\tconst viewZ = perspectiveDepthToViewZ( texture, cameraNear, cameraFar );\n\t\t\tnode = viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t}\n\n\t\treturn node;\n\n\t}\n\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\n// -near maps to 0; -far maps to 1\nexport const viewZToOrthographicDepth = ( viewZ, near, far ) => viewZ.add( near ).div( near.sub( far ) );\n\n// maps orthographic depth in [ 0, 1 ] to viewZ\nexport const orthographicDepthToViewZ = ( depth, near, far ) => near.sub( far ).mul( depth ).sub( near );\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\n// -near maps to 0; -far maps to 1\nexport const viewZToPerspectiveDepth = ( viewZ, near, far ) => near.add( viewZ ).mul( far ).div( near.sub( far ).mul( viewZ ) );\n\n// maps perspective depth in [ 0, 1 ] to viewZ\nexport const perspectiveDepthToViewZ = ( depth, near, far ) => near.mul( far ).div( far.sub( near ).mul( depth ).sub( far ) );\n\nViewportDepthNode.DEPTH = 'depth';\nViewportDepthNode.DEPTH_TEXTURE = 'depthTexture';\n\nexport default ViewportDepthNode;\n\nexport const depth = nodeImmutable( ViewportDepthNode, ViewportDepthNode.DEPTH );\nexport const depthTexture = nodeProxy( ViewportDepthNode, ViewportDepthNode.DEPTH_TEXTURE );\n\naddNodeClass( 'ViewportDepthNode', ViewportDepthNode );\n"],"mappings":"AAAA,OAAOA,IAAI,IAAIC,YAAY,QAAQ,iBAAiB;AACpD,SAASC,aAAa,EAAEC,SAAS,QAAQ,6BAA6B;AACtE,SAASC,UAAU,EAAEC,SAAS,QAAQ,4BAA4B;AAClE,SAASC,YAAY,QAAQ,8BAA8B;AAC3D,SAASC,oBAAoB,QAAQ,+BAA+B;AAEpE,MAAMC,iBAAiB,SAASR,IAAI,CAAC;EAEpCS,WAAWA,CAAEC,KAAK,EAAEC,WAAW,GAAG,IAAI,EAAG;IAExC,KAAK,CAAE,OAAQ,CAAC;IAEhB,IAAI,CAACD,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACC,WAAW,GAAGA,WAAW;IAE9B,IAAI,CAACC,mBAAmB,GAAG,IAAI;EAEhC;EAEAC,KAAKA,CAAA,CAAE;EAAA,EAAc;IAEpB,MAAM;MAAEH;IAAM,CAAC,GAAG,IAAI;IAEtB,IAAII,IAAI,GAAG,IAAI;IAEf,IAAKJ,KAAK,KAAKF,iBAAiB,CAACO,KAAK,EAAG;MAExCD,IAAI,GAAGE,wBAAwB,CAAEV,YAAY,CAACW,CAAC,EAAEb,UAAU,EAAEC,SAAU,CAAC;IAEzE,CAAC,MAAM,IAAKK,KAAK,KAAKF,iBAAiB,CAACU,aAAa,EAAG;MAEvD,MAAMC,OAAO,GAAG,IAAI,CAACR,WAAW,IAAIJ,oBAAoB,CAAC,CAAC;MAE1D,MAAMa,KAAK,GAAGC,uBAAuB,CAAEF,OAAO,EAAEf,UAAU,EAAEC,SAAU,CAAC;MACvES,IAAI,GAAGE,wBAAwB,CAAEI,KAAK,EAAEhB,UAAU,EAAEC,SAAU,CAAC;IAEhE;IAEA,OAAOS,IAAI;EAEZ;AAED;;AAEA;;AAEA;AACA,OAAO,MAAME,wBAAwB,GAAGA,CAAEI,KAAK,EAAEE,IAAI,EAAEC,GAAG,KAAMH,KAAK,CAACI,GAAG,CAAEF,IAAK,CAAC,CAACG,GAAG,CAAEH,IAAI,CAACI,GAAG,CAAEH,GAAI,CAAE,CAAC;;AAExG;AACA,OAAO,MAAMI,wBAAwB,GAAGA,CAAEC,KAAK,EAAEN,IAAI,EAAEC,GAAG,KAAMD,IAAI,CAACI,GAAG,CAAEH,GAAI,CAAC,CAACM,GAAG,CAAED,KAAM,CAAC,CAACF,GAAG,CAAEJ,IAAK,CAAC;;AAExG;;AAEA;AACA,OAAO,MAAMQ,uBAAuB,GAAGA,CAAEV,KAAK,EAAEE,IAAI,EAAEC,GAAG,KAAMD,IAAI,CAACE,GAAG,CAAEJ,KAAM,CAAC,CAACS,GAAG,CAAEN,GAAI,CAAC,CAACE,GAAG,CAAEH,IAAI,CAACI,GAAG,CAAEH,GAAI,CAAC,CAACM,GAAG,CAAET,KAAM,CAAE,CAAC;;AAE/H;AACA,OAAO,MAAMC,uBAAuB,GAAGA,CAAEO,KAAK,EAAEN,IAAI,EAAEC,GAAG,KAAMD,IAAI,CAACO,GAAG,CAAEN,GAAI,CAAC,CAACE,GAAG,CAAEF,GAAG,CAACG,GAAG,CAAEJ,IAAK,CAAC,CAACO,GAAG,CAAED,KAAM,CAAC,CAACF,GAAG,CAAEH,GAAI,CAAE,CAAC;AAE7Hf,iBAAiB,CAACO,KAAK,GAAG,OAAO;AACjCP,iBAAiB,CAACU,aAAa,GAAG,cAAc;AAEhD,eAAeV,iBAAiB;AAEhC,OAAO,MAAMoB,KAAK,GAAG1B,aAAa,CAAEM,iBAAiB,EAAEA,iBAAiB,CAACO,KAAM,CAAC;AAChF,OAAO,MAAMgB,YAAY,GAAG5B,SAAS,CAAEK,iBAAiB,EAAEA,iBAAiB,CAACU,aAAc,CAAC;AAE3FjB,YAAY,CAAE,mBAAmB,EAAEO,iBAAkB,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}